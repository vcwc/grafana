#!/usr/bin/env bash

# START CONFIGURATION
DOLLAR='$'
export VCW_STACK_GLOBAL_STACKS="vcwc/grafana/traefik"
export VCW_STACK_GLOBAL_STACKNAMES="vcw_stack_grafana"
export VCW_STACK_GLOBAL_BOOTSTACKS=""
export VCW_STACK_GLOBAL_RUNSTACKS="vcw_stack_grafana"
export VCW_STACK_GLOBAL_VOLUME_LIST="${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_grafana_volume"
export VCW_STACK_GLOBAL_VOLUME_INITIALISED="${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_grafana_volume:/var/lib/grafana"
# END CONFIGURATION

# START GLOBAL SETTINGS
export VCW_STACK_GLOBAL='\
$VCW_STACK_GLOBAL_SERVICE_NAME,\
$VCW_STACK_GLOBAL_IMAGE_NAME,\
$VCW_STACK_GRAFANA_ENVIRONMENT,\
$VCW_STACK_GRAFANA_COMMAND,\
$VCW_STACK_GRAFANA_PORTS,\
$VCW_STACK_GRAFANA_VOLUMES,\
$VCW_STACK_GRAFANA_NETWORKS,\
$VCW_STACK_GRAFANA_DEPLOY_MODE,\
$VCW_STACK_GRAFANA_COMPOSE_EXTENSIONS,\
$VCW_STACK_GLOBAL_VOLUMES,\
$VCW_STACK_GLOBAL_NETWORKS'
export VCW_STACK_GLOBAL_SERVICE_NAME="grafana"
export VCW_STACK_GLOBAL_IMAGE_NAME="grafana/grafana"
export VCW_STACK_GRAFANA_ENVIRONMENT="\
'GF_SERVER_SERVE_FROM_SUB_PATH=true', \
'GF_SECURITY_ALLOW_EMBEDDING=true', \
'GF_AUTH_ANONYMOUS_ENABLED=true', \
'GF_AUTH_ANONYMOUS_ORG_NAME=Main Org.', \
'GF_AUTH_ANONYMOUS_ORG_ROLE=${DOLLAR}{VCW_STACK_GRAFANA_MODULE_GRAFANA_AUTH_ANONYMOUS_ORG_ROLE}', \
'GF_LOG_MODE=console', \
'GF_LOG_CONSOLE_FORMAT=text', \
'GF_LOG_LEVEL=${DOLLAR}{VCW_STACK_GRAFANA_MODULE_GRAFANA_LOG_LEVEL}', \
'GF_SERVER_ROOT_URL=/${DOLLAR}{VCW_STACK_GLOBAL_URLPREFIX}/grafana'"
export VCW_STACK_GRAFANA_COMMAND=
export VCW_STACK_GRAFANA_PORTS=
export VCW_STACK_GRAFANA_VOLUMES="'${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_grafana_volume:/var/lib/grafana'"
export VCW_STACK_GRAFANA_NETWORKS="${DOLLAR}{VCW_STACK_GLOBAL_NETWORKGLOBAL}_overlay, ${DOLLAR}{VCW_STACK_GLOBAL_NETWORKLOCAL}_overlay"
export VCW_STACK_GRAFANA_DEPLOY_MODE="replicated"
export VCW_STACK_GRAFANA_COMPOSE_EXTENSIONS="
      labels: [traefik.enable=true,traefik.docker.network=${DOLLAR}{VCW_STACK_GLOBAL_NETWORKGLOBAL}_overlay,
      traefik.http.services.${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_grafana.loadbalancer.server.port=3000,
      traefik.http.routers.${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_grafana.entrypoints=conteco,
      traefik.http.routers.${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_grafana.rule=PathPrefix(\"/${DOLLAR}{VCW_STACK_GLOBAL_URLPREFIX}/grafana\")]
${DOLLAR}{VCW_STACK_GRAFANA_COMPOSE_EXTENSIONS}"
export VCW_STACK_GLOBAL_VOLUMES="${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_grafana_volume: { external: true }"
export VCW_STACK_GLOBAL_NETWORKS="${DOLLAR}{VCW_STACK_GLOBAL_NETWORKGLOBAL}_overlay: { external: true }, ${DOLLAR}{VCW_STACK_GLOBAL_NETWORKLOCAL}_overlay: { external: true }"
# END GLOBAL SETTINGS

# START SETTINGS grafana.base
export VCW_STACK_GRAFANA_ENVIRONMENT_GRAFANA_AUTH_ANONYMOUS_ORG_ROLE="Editor"
export VCW_STACK_GRAFANA_ENVIRONMENT_GRAFANA_LOG_LEVEL="warning"
export VCW_STACK_GRAFANA_DEPLOY_RESOURCES_LIMITS_MEMORY="128m"
export VCW_STACK_GRAFANA_DEPLOY_RESOURCES_RESERVATIONS_MEMORY="64m"
# END SETTINGS grafana.base

# START TOPLEVEL SETTINGS
# END TOPLEVEL SETTINGS
